# 기능 명세서

## 1. 사용자 플로우

```
QR스캔 → 웹사이트 접속 → 이름 입력 → 뽑기판 화면 → 번호 선택 → 결과 확인
```

## 2. 화면별 기능

### 2.1 참가자 입장 화면
| 기능 | 설명 |
|------|------|
| 이름 입력 | 2~10자 한글/영문 이름 입력 |
| 중복 체크 | 이미 참여한 이름인지 확인 (선택적) |
| 입장 버튼 | 뽑기판 화면으로 이동 |

### 2.2 뽑기판 화면 (메인)
| 기능 | 설명 |
|------|------|
| 100칸 뽑기판 | 10x10 그리드 형태의 뽑기판 표시 |
| 번호 표시 | 각 칸에 1~100 번호 표시 |
| 상태 표시 | 뽑힘/안뽑힘 시각적 구분 |
| 뽑은 사람 표시 | 뽑힌 칸에 참가자 이름 표시 |
| 실시간 업데이트 | WebSocket으로 즉시 반영 |
| 뽑기 애니메이션 | 뽑을 때 시각적 효과 |

### 2.3 결과 화면 (모달/팝업)
| 기능 | 설명 |
|------|------|
| 결과 표시 | 경품명 또는 꽝 표시 |
| 축하 효과 | 경품 당첨 시 컨페티 효과 |
| 확인 버튼 | 모달 닫기 |

### 2.4 관리자 화면
| 기능 | 설명 |
|------|------|
| 경품 설정 | 각 번호별 경품/꽝 설정 |
| 일괄 설정 | CSV 업로드 또는 랜덤 배치 |
| 게임 상태 관리 | 대기/진행중/종료 상태 변경 |
| 리셋 기능 | 게임 초기화 |
| 결과 조회 | 누가 무엇을 뽑았는지 현황 |
| 결과 내보내기 | 엑셀/CSV 다운로드 |

## 3. 상세 기능 명세

### 3.1 뽑기 프로세스
```
1. 참가자가 빈 칸 클릭
2. 서버에 뽑기 요청 전송
3. 서버에서 해당 칸 상태 확인
   - 이미 뽑힌 칸: 에러 반환
   - 빈 칸: 뽑기 처리 진행
4. DB에 뽑기 결과 저장 (트랜잭션)
5. 실시간 브로드캐스트 (모든 클라이언트에 알림)
6. 결과 모달 표시
```

### 3.2 동시성 처리
- Supabase Row Level Security 활용
- 낙관적 잠금(Optimistic Locking) 적용
- 서버 사이드 유효성 검증

### 3.3 실시간 동기화
- Supabase Realtime 구독
- 뽑기 이벤트 발생 시 모든 클라이언트 자동 업데이트
- 연결 끊김 시 자동 재연결

## 4. 경품 구조

### 4.1 경품 등급 예시
| 등급 | 개수 | 예시 |
|------|------|------|
| 1등 | 1개 | 상품권 10만원 |
| 2등 | 3개 | 상품권 5만원 |
| 3등 | 5개 | 상품권 1만원 |
| 4등 | 10개 | 편의점 상품권 5천원 |
| 5등 | 20개 | 커피 쿠폰 |
| 꽝 | 61개 | 다음 기회에... |

### 4.2 경품 배치
- 관리자가 수동 배치 또는
- 랜덤 자동 배치 기능 제공

## 5. 예외 처리

| 상황 | 처리 방법 |
|------|----------|
| 동시 클릭 | 먼저 처리된 요청만 성공, 나머지는 "이미 뽑힌 번호" 알림 |
| 네트워크 오류 | 재시도 버튼 표시, 자동 재연결 |
| 게임 종료 상태 | 뽑기 버튼 비활성화, 안내 메시지 |
| 이미 참여한 사용자 | 결과 조회만 가능 (선택적) |
